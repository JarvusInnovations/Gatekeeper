version: '2'

services:
  db:
    image: core/mysql
    environment:
      HAB_MYSQL: |
        app_username = "gatekeeper"
        app_password = "gatekeeper"
        bind = "0.0.0.0"
    volumes:
      - mysql-data:/hab/svc/mysql/data

  app:
    image: jarvus/gatekeeper-app
    depends_on:
      - db
    command: --peer db --bind database:mysql.default

  http:
    image: jarvus/gatekeeper-http
    depends_on:
      - app
    environment:
      HAB_GATEKEEPER_HTTP: |
        [http.listen]
        port = 7080
    ports:
      - 7080:7080
    command: --peer app --bind app:gatekeeper-app.default


volumes:
  mysql-data:
