echo
echo "--> Installing and loading emergence/studio..."
hab pkg install emergence/studio
source "$(hab pkg path emergence/studio)/studio.sh"


echo
echo "--> Setting up development commands..."

init-user-config php-runtime '
    [sites.default.holo]
    gitDir = "/src/.git"
'

echo "    * Use 'update-site' to update the running site from /src
update-site() {
    pushd /src > /dev/null

    git holo project site --working | /hab/svc/php-runtime/config/fpm-exec --stdin PUT load.php

    popd > /dev/null
}

echo "    * Use 'watch-site' to watch the running site in /src
watch-site() {
    pushd /src > /dev/null

    git holo project site --working --watch | xargs -n 1 /hab/svc/php-runtime/config/fpm-exec PUT load.php

    popd > /dev/null
}


# overall instructions
echo
echo "    For a complete studio debug environment:"
echo "      start-all-local && watch-site"


# final blank line
echo
